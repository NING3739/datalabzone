---
title: "Cost Calculator"
date: "2023-04-05"
author: NING LI
categories: [R, Shiny]
image: "https://plus.unsplash.com/premium_photo-1678374802606-526973c76dcd?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8N3x8Q09TVCUyMENBTENVTEFUT1J8ZW58MHx8MHx8&auto=format&fit=crop&w=500&q=60"
description: "This sample employs the Shiny package to create a service fee calculator app."
format:
  html:
    code-fold: true
---

# Introduction to Shiny

Shiny is an R package for creating interactive web applications directly from R without requiring web development knowledge. A Shiny app generally consists of a user interface (UI) and a server component that contains the app's logic and computations.

# Purpose of this app

This Shiny app is a service fee calculator designed to calculate and track service fees based on various parameters, such as customer name, service type, add-on services, and service time. The app also allows users to apply or remove a 15% Goods and Services Tax (GST) on the total cost.

# User Interface (UI)

The UI is divided into three main sections:

a.  *Header Panel*: Contains the app's title "æœåŠ¡è´¹ç”¨è®¡ç®—å™¨" (Service Fee Calculator).

b.  *Sidebar Panel*: Includes input fields for customer name, service type, add-on services, service time, and service date. It also has action buttons for adding/removing GST, adding a service record, and generating a chart.

c.  *Main Panel*: Displays the calculated total cost, a table of service records, a time series plot of service costs, and a download button for exporting the service records as a CSV file.

# Server Component

The server component handles the app's logic and computations, including:

a.  *Calculating the total cost*: Determines the total cost based on service type, add-on services, and service time.

b.  *Applying/removing GST*: Applies or removes a 15% GST on the total cost based on user input.

c.  *Managing service records*: Stores service records in a reactive data frame, updates the records when a new entry is added, and arranges the records in descending order by date.

d.  *Generating a time series plot*: Creates a time series plot of service costs using ggplot2 when the "ç”Ÿæˆå›¾è¡¨" (Generate Chart) button is clicked.

e.  *Downloading service records*: Allows users to download service records as a CSV file, with a filename containing the current date.

In summary, this Shiny app is a user-friendly service fee calculator that helps users input various parameters, calculate the total cost, apply or remove GST, store and display service records, and generate a time series plot of service costs.

# Code

```{r, echo=TRUE, eval=FALSE}
library(shiny)
library(dplyr)
library(ggplot2)
library(shinythemes)


custom_css <- "
.record-table {
  margin-top: 20px;
}
"

# å®šä¹‰ UI ç»„ä»¶
ui <- bootstrapPage(
  theme = shinytheme("flatly"),
  headerPanel("æœåŠ¡è´¹ç”¨è®¡ç®—å™¨"),
  sidebarPanel(
    textInput(inputId = "name", label = "å®¢æˆ·åå­—ï¼š", value = ""),
    selectInput(inputId = "service", label = "æœåŠ¡ç±»å‹ï¼š", 
                choices = c("æ—¥å¸¸æ¸…æ´", "æ·±å±‚æ¸…æ´", "æ¬å‡º/æ¬å…¥")),
    checkboxGroupInput(inputId = "addone", label = "é™„åŠ æœåŠ¡ï¼š", 
                       choices = c("çƒ¤ç®±" = "çƒ¤ç®±", "çª—æˆ·" = "çª—æˆ·", "å¢™å’Œå¤©èŠ±æ¿" = "å¢™å’Œå¤©èŠ±æ¿")),
    numericInput(inputId = "oven_num", label = "çƒ¤ç®±æ•°é‡ï¼š", value = 1, min = 1),
    numericInput(inputId = "window_num", label = "çª—æˆ·æ•°é‡ï¼š", value = 1, min = 1),
    textInput(inputId = "time", label = "æœåŠ¡æ—¶é—´ï¼ˆå°æ—¶ï¼‰ï¼š", value = "1"),
    dateInput(inputId = "date", label = "æœåŠ¡æ—¥æœŸï¼š", 
              value = Sys.Date()),
    actionButton(inputId = "add_gst_button", label = "æ·»åŠ  GSTï¼ˆ15%ï¼‰"),
    actionButton(inputId = "remove_gst_button", label = "å–æ¶ˆ GSTï¼ˆ15%ï¼‰"),
    actionButton(inputId = "add", label = "æ·»åŠ æœåŠ¡è®°å½•"),
    actionButton(inputId = "plot_button", label = "ç”Ÿæˆå›¾è¡¨")
  ),
  mainPanel(
    h3("è®¡ç®—ç»“æœï¼š"),
    textOutput(outputId = "total"),
    downloadButton(outputId = "download", label = "ä¸‹è½½æœåŠ¡è®°å½•"),
    tags$head(tags$style(HTML(custom_css))),
    fluidRow(
      column(12,
             plotOutput(outputId = "plot")
      ),
      column(12,
             div(class = "record-table",
                 tableOutput(outputId = "records")
             )
      )
    )
  ),
)
  

# å®šä¹‰ server ç»„ä»¶
server <- function(input, output, session) {
  gst_active <- reactiveVal(FALSE)
  
  observeEvent(input$add_gst_button, {
    gst_active(TRUE)
  })
  
  observeEvent(input$remove_gst_button, {
    gst_active(FALSE)
  })
  
  
  service_records <- reactiveValues(data = data.frame(Date = character(),
                                                      Name = character(),
                                                      Service = character(),
                                                      Time = numeric(),
                                                      Cost = numeric(),
                                                      Deleted = logical(),
                                                      stringsAsFactors = FALSE))
  
  
  # è®¡ç®—æ€»è´¹ç”¨
  total_cost <- reactive({
    if(input$service == "æ—¥å¸¸æ¸…æ´") {
      cost_per_hour_service <- 40
    } else if(input$service == "æ·±å±‚æ¸…æ´") {
      cost_per_hour_service <- 100
    } else {
      cost_per_hour_service <- 200
    }
    
    # åˆå§‹åŒ– cost_per_hour_addone å˜é‡
    cost_per_hour_addone <- 0
    
    if("çƒ¤ç®±" %in% input$addone) {
      cost_per_hour_addone <- cost_per_hour_addone + (60 * input$oven_num)
    }
    if("çª—æˆ·" %in% input$addone) {
      cost_per_hour_addone <- cost_per_hour_addone + (30 * input$window_num)
    }
    if("å¢™å’Œå¤©èŠ±æ¿" %in% input$addone) {
      cost_per_hour_addone <- cost_per_hour_addone + 120
    }
    
    total <- (cost_per_hour_service) * as.numeric(input$time) + cost_per_hour_addone
    
    # åº”ç”¨ GST
    if (gst_active()) {
      total <- total * 1.15
    }
    
    return(total)
  })
  
  
  # æ·»åŠ æœåŠ¡è®°å½•
  observeEvent(input$add, {
    if(input$name != "") {
      record <- data.frame(Date = format(input$date, "%m/%d/%y"),
                           Name = input$name,
                           Service = paste(input$service, "å’Œ", paste(input$addone, collapse = "ï¼Œ")),
                           Time = as.numeric(input$time),
                           Cost = total_cost(),
                           stringsAsFactors = FALSE)
      service_records$data <- rbind(service_records$data, record)
    }
  })
  
  
  # æ˜¾ç¤ºè®¡ç®—ç»“æœ
  output$total <- renderText({
    if(input$name != "") {
      cost <- total_cost()
      paste0(input$name, " éœ€è¦æ”¯ä»˜ $", round(cost, 2), " çš„æœåŠ¡è´¹ç”¨ã€‚")
    } else {
      "è¯·è¾“å…¥å®¢æˆ·åå­—ã€‚"
    }
  })
  
  # ç»˜åˆ¶æ—¶é—´åºåˆ—å›¾
  output$plot <- renderPlot({
    if(input$plot_button > 0) {
      plot_data <- service_records$data %>%
        mutate(Date = as.Date(Date, "%m/%d/%y")) %>%
        group_by(Date) %>%
        summarize(TotalCost = sum(Cost))
      
      ggplot(plot_data, aes(x = Date, y = TotalCost)) +
        geom_line() +
        geom_text(aes(label = round(TotalCost, 2)), vjust = -0.5, size = 4) +
        labs(title = "æœåŠ¡è´¹ç”¨æ—¶é—´åºåˆ—å›¾", x = "æ—¥æœŸ", y = "æœåŠ¡è´¹ç”¨") +
        theme_minimal()
    }
  })
  
  
  # ä¸‹è½½æœåŠ¡è®°å½•
  output$download <- downloadHandler(
    filename = function() {
      paste("service_records_", Sys.Date(), ".csv", sep = "")
    },
    content = function(file) {
      req(service_records$data)
      write.csv(service_records$data, file, row.names = FALSE)
    }
  )
  
  # æ˜¾ç¤ºæœåŠ¡è®°å½•
  output$records <- renderTable({
    service_records$data %>%
      arrange(desc(Date))
  })
  
}

# è¿è¡Œåº”ç”¨ç¨‹åº
shinyApp(ui, server)

```


ğŸ‘‰ [Run Cost Calculator App](https://myshinyappforpractice.shinyapps.io/sheet/)


